/*! multiellipsis - v1.0 - 2013-09-18 4:37:11 PM
* Copyright (c) 2013 筱谷; Licensed  */
KISSY.add("gallery/multiellipsis/1.0/index",function(a,b){var c,d,e,f;return c=b.all,d={height:0,interval:5,endHTML:"...",exact:!1,child:"",keepLine:!1,setTitle:!1},e=function(b,e){var g,h,i,j;if(e=a.merge(d,e),g=c(b),g&&g.length){for(j=[],h=0,i=g.length;i>h;h++)b=g[h],j.push(f(b,e));return j}},f=function(b,d){var e,f,g,h,i;if(b=c(b),d={height:b.attr("data-ks-height")||d.height||b.innerHeight(),interval:b.attr("data-ks-interval")||d.interval,endHTML:b.attr("data-ks-endhtml")||d.endHTML,exact:b.attr("data-ks-exact")||d.exact,child:b.attr("data-ks-child")||d.child,keepLine:b.attr("data-ks-keepline")||d.keepLine,setTitle:b.attr("data-ks-settitle")||d.setTitle},i=d.child?b.one(d.child):b,d.text=i.attr("data-ks-text")||b.attr("data-ks-text")||i.text(),"inline"===b.css("display")?(b.css("overflow","visible"),b.scrollHeightFunc=b.innerHeight):b.scrollHeightFunc=function(){return b[0].scrollHeight},d.keepLine||(d.text=d.text.replace(/[\r\n]/gi,"")),b.show(),!(b.scrollHeightFunc()<=d.height)){for(h=d.text,e=d.endHTML,f=h.length,i.html(h+e);b.scrollHeightFunc()>d.height&&f>=0;)h=h.substring(0,f-d.interval),f-=d.interval,i.html(h+e);if(d.exact){for(g=0;b.scrollHeightFunc()<=d.height&&g<d.text.length-f;)h=d.text.substring(0,f+g++),i.html(h+e);i.html(d.text.substring(0,f+g-2)+e)}return d.setTitle&&i.attr("title",d.text),b.scrollHeightFunc()>d.height?a.log("Failed"):void 0}},e},{requires:["node"]});